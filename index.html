<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>AI Crime Scene – Elite Investigator Edition (v10 Gold)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<style>
:root{--gold:#d4af37;--dark:#0a0c0f;--glass:#0f1317cc}
*{box-sizing:border-box}
html,body{margin:0;height:100%;overflow:hidden;background:var(--dark);font-family:"Tajawal",system-ui,Arial;color:#fff}
a-scene{width:100%;height:100vh;z-index:1}

/* شاشة البداية */
#overlayStart{
  position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(700px 420px at 50% 40%, rgba(212,175,55,.15), rgba(0,0,0,.8));
  z-index:12000;text-align:center;color:var(--gold);font-size:22px
}
#overlayStart button{
  margin-top:20px;padding:10px 24px;border:none;border-radius:12px;cursor:pointer;
  background:linear-gradient(90deg,var(--gold),#b78f2a);color:#000;font-weight:800;font-size:18px;
  box-shadow:0 0 14px rgba(212,175,55,.5);transition:transform .18s ease, box-shadow .18s ease, filter .2s ease
}
#overlayStart button:hover{ box-shadow:0 0 26px rgba(212,175,55,.85); filter:brightness(1.05) }
#overlayStart button:active{ transform:scale(.96) }

/* HUD */
#hud{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.55);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:6px 12px;font-weight:800;z-index:11000;display:flex;gap:10px;align-items:center}
#time{color:#d4af37}#status{color:#cfe1ff}#score{color:#39d98a}

/* الافتار */
#didWrap{
  position:fixed;
  z-index:10003;
  transform-origin: 50% 100%;
  width:320px;
  max-width:40vw;
  animation: idleBob 3s ease-in-out infinite;
}
@keyframes idleBob {
  0%{transform:translateY(0) scale(var(--s,1));}
  50%{transform:translateY(-4px) scale(var(--s,1));}
  100%{transform:translateY(0) scale(var(--s,1));}
}
</style>
</head>
<body>

<div id="overlayStart">
  <div>مرحبًا بكم في إعادة بناء مسرح الجريمة<br>اضغط للبدء</div>
  <button id="btnStart" onclick="startApp()">ابدأ</button>
</div>

<div id="hud">
  ⏱ <span id="time">--:--</span> | <span id="status">جاهز</span> | 🧮 <span id="score">0</span>
</div>

<a-scene embedded renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true">
  <a-plane rotation="-90 0 0" width="30" height="30"
    material="src: url(https://cdn.polyhaven.com/asset_img/primary/long_white_tiles.png?height=760&quality=95); repeat: 1 15;">
  </a-plane>
  <a-box position="0 3 -15" width="30" height="6" depth="0.12"
    material="src: url(https://cdn.polyhaven.com/asset_img/primary/red_brick.png?height=760&quality=95); repeat: 3 1;"></a-box>
  <a-box position="0 3 15" width="30" height="6" depth="0.12"
    material="src: url(https://cdn.polyhaven.com/asset_img/primary/red_brick.png?height=760&quality=95); repeat: 3 1;"></a-box>
  <a-box position="-15 3 0" width="0.12" height="6" depth="30"
    material="src: url(https://cdn.polyhaven.com/asset_img/primary/red_brick.png?height=760&quality=95); repeat: 3 1;"></a-box>
  <a-box position="15 3 0" width="0.12" height="6" depth="30"
    material="src: url(https://cdn.polyhaven.com/asset_img/primary/red_brick.png?height=760&quality=95); repeat: 3 1;"></a-box>

  <!-- إضاءة -->
  <a-entity light="type:ambient; intensity:0.55"></a-entity>
  <a-entity light="type:point; intensity:0.9; color:#d4af37" position="0 3 0"></a-entity>

  <!-- الكاميرا -->
  <a-entity id="rig" position="0 1.6 6">
    <a-entity id="cam" camera look-controls="touchEnabled:true" wasd-controls="acceleration:30"></a-entity>
  </a-entity>

  <!-- مرساة الافتار -->
  <a-entity id="didAnchor" position="-8 1.2 -5"></a-entity>
</a-scene>

<!-- الافتار -->
<div id="didWrap">
  <script type="module"
    src="https://agent.d-id.com/v2/index.js"
    data-mode="fabio"
    data-client-key="Z29vZ2xlLW9hdXRoMnwxMTYxMTA1NDg0NzE4MjIxMjEzNzU6ZW1hOGpRYnRPcnJOSENjeU9nTUF3"
    data-agent-id="v2_agt_JPqY3TqZ"
    data-name="did-agent"
    data-monitor="true"
    data-orientation="horizontal"
    data-position="right">
  </script>
</div>

<script>
function startApp(){
  document.getElementById('overlayStart').remove();

  // تشغيل الصوت العربي
  if('speechSynthesis' in window){
    const utter = new SpeechSynthesisUtterance("مرحبًا، أنا المحقق الذكي المساعد. سأرشدك خلال إعادة بناء مسرح الجريمة.");
    utter.lang = 'ar-SA';
    speechSynthesis.speak(utter);
  }

  // محاولة تشغيل الافتار تلقائيًا
  setTimeout(()=>{
    window.postMessage({
      type:'did-agent-say',
      text:'مرحبًا، أنا المحقق الذكي المساعد. سأرشدك خلال إعادة بناء مسرح الجريمة.',
      lang:'ar'
    }, '*');
  },800);
}

// ربط موقع الافتار داخل المشهد
function updateDidPosition(){
  const anchor=document.querySelector('#didAnchor');
  const wrap=document.querySelector('#didWrap');
  const cam=document.querySelector('#cam');
  if(!anchor||!wrap||!cam)return;
  const three=AFRAME.THREE;
  const camera=cam.getObject3D('camera');
  const obj=anchor.object3D;
  if(!camera||!obj)return;
  const vector=new three.Vector3();
  obj.updateMatrixWorld();
  vector.setFromMatrixPosition(obj.matrixWorld);
  vector.project(camera);
  const w=window.innerWidth,h=window.innerHeight;
  const x=(vector.x*0.5+0.5)*w;
  const y=(-vector.y*0.5+0.5)*h;
  wrap.style.left=(x-160)+'px';
  wrap.style.top=(y-300)+'px';
}
function raf(){updateDidPosition();requestAnimationFrame(raf);}
requestAnimationFrame(raf);
</script>

</body>
</html>
